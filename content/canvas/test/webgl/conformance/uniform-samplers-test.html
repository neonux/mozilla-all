<!--
Copyright (c) 2009 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
 -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>WebGL sampler uniforms conformance test.</title>
    <link rel="stylesheet" href="../resources/js-test-style.css"/>
    <script src="../resources/js-test-pre.js"></script>
    <script src="resources/webgl-test.js"> </script>
    <script src="../../debug/webgl-debug.js"> </script>
</head>
<body>
<canvas id="example" width="2" height="2" style="width: 40px; height: 40px;"></canvas>
<div id="description"></div>
<div id="console"></div>
<script id="vshader" type="x-shader/x-vertex">
attribute vec4 vPosition;
attribute vec2 texCoord0;
varying vec2 texCoord;
void main()
{
  gl_Position = vPosition;
  texCoord = texCoord0;
}
</script>

<script id="fshader" type="x-shader/x-fragment">
uniform sampler2D tex;
varying vec2 texCoord;
void main()
{
  gl_FragColor = texture2D(tex, texCoord);
}
</script>

  <script>
function init()
{
  if (window.layoutTestController) {
    layoutTestController.overridePreference("WebKitWebGLEnabled", "1");
    layoutTestController.dumpAsText();
  }

  debug("Tests that only Uniform1i and Uniform1iv can be used to set");
  debug("sampler uniforms.");
  debug("");

  var canvas2d = document.getElementById("canvas2d");

  gl = initWebGL("example", "vshader", "fshader", [ "vPosition", "texCoord0"],
                 [ 0, 0, 0, 1 ], 1);
  gl = WebGLDebugUtils.makeDebugContext(gl);

  var textureLoc = gl.getUniformLocation(gl.program, "tex");

  gl.uniform1i(textureLoc, 1);
  assertMsg(gl.getError() == gl.NO_ERROR,
            "uniform1i can set a sampler uniform");
  gl.uniform1iv(textureLoc, [1]);
  assertMsg(gl.getError() == gl.NO_ERROR,
            "uniform1iv can set a sampler uniform");
  gl.uniform1f(textureLoc, 1);
  assertMsg(gl.getError() == gl.INVALID_OPERATION,
            "uniform1f returns INVALID_OPERATION if attempting to set a sampler uniform");
  gl.uniform1fv(textureLoc, [1]);
  assertMsg(gl.getError() == gl.INVALID_OPERATION,
            "uniform1fv returns INVALID_OPERATION if attempting to set a sampler uniform");
}

init();
successfullyParsed = true;
</script>
</body>
<script src="../resources/js-test-post.js"></script>

<script>
</script>

</body>
</html>

