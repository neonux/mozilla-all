DEPTH = ../..
topsrcdir = @top_srcdir@
srcdir = @srcdir@
VPATH = @srcdir@

include $(DEPTH)/config/autoconf.mk

MOZILLA_INTERNAL_API = 1

REQUIRES = \
  string \
  xpcom \
  $(NULL)

include $(topsrcdir)/config/rules.mk

DUMP_CLASSES = \
  nsAString_internal \
  nsACString_internal \
  nsString \
  nsCString \
  nsAutoString \
  nsCAutoString \
  nsXPIDLString \
  nsXPIDLCString \
  $(NULL)

SPACE = $(NULL) $(NULL)
COMMA = ,

HGREV = $(shell hg -R $(topsrcdir) id -i)

classapi: DEHYDRA_MODULES = $(srcdir)/type-printer.js
classapi: TREEHYDRA_MODULES =
classapi: DEHYDRA_ARGS += --dump-types=$(subst $(SPACE),$(COMMA),$(strip $(DUMP_CLASSES))) --rev=$(HGREV)
classapi:
	$(CCC) $(OUTOPTION)/dev/null -c $(COMPILE_CXXFLAGS) $(srcdir)/type-printer.cpp
	$(EXIT_ON_ERROR) \
	for class in $(DUMP_CLASSES); do \
	  $(PYTHON) $(srcdir)/fix-srcrefs.py $(topsrcdir) < $${class}.html > $${class}-fixed.html; \
	done

upload_classapi:
	for class in $(DUMP_CLASSES); do \
	  $(PYTHON) $(srcdir)/MDC-upload.py $${class}-fixed.html en/$${class}; \
	done
